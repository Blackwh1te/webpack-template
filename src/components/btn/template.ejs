<%
const {classNames} = require('../../js/ejsUtils')
const cfg = {...require('./data.json'), ...arguments?.[0]}
const {
	extraClasses,
	extraAttrs,
	type,
	href,
	icon,
	caption,
	disabled,
} = cfg
%>

<%
const getIconMarkup = () => {
	if (!icon) return ''
	return `
		<svg class="btn__icon i-icon">
			<use href="#icon-${icon.name}"></use>
		</svg>
	`
}

const getBtnBodyMarkup = () => {
	const classes = classNames('btn__caption', {
		'visually-hidden': caption.isHidden
	})
	return `
		${icon.position !== 'after' ? getIconMarkup() : ''}
		<span class="${classes}">${caption.text}</span>
		${icon.position === 'after' ? getIconMarkup() : ''}
	`
}

const classes = classNames('btn', extraClasses, {
	'btn--icon-only': icon && caption.isHidden
})

let dataAttrs = ''
if (!caption.isHidden) {
	dataAttrs += ' data-js-btn'
}
%>

<% if (href) { %>
	<a
		class="<%= classes %>"
		href="<%= href %>"
		<% if (caption.isHidden) { %>
			title="<%= caption.text %>"
			aria-label="<%= caption.text %>"
		<% } %>
		<%- dataAttrs %>
		<%- extraAttrs %>
	>
		<%- getBtnBodyMarkup() %>
	</a>
<% } else { %>
	<button
		class="<%= classes %>"
		type="<%= type %>"
		<% if (caption.isHidden) { %>
			title="<%= caption.text %>"
			aria-label="<%= caption.text %>"
		<% } %>
		<% if (disabled) { %>
			disabled
		<% } %>
		<%- dataAttrs %>
		<%- extraAttrs %>
	>
		<%- getBtnBodyMarkup() %>
	</button>
<% } %>
